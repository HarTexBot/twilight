<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="twilight-gateway-queue"><title>twilight_gateway_queue - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../static.files/rustdoc-1def573a4779b29b.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../static.files/light-d59023bfa12059d2.css"><link rel="stylesheet" disabled href="../static.files/dark-1ca41bb1e10af075.css"><link rel="stylesheet" disabled href="../static.files/ayu-18b4181a2f3fb862.css"><script src="../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="../crates.js"></script><script defer src="../static.files/main-98a684e84ae5b08b.js"></script><noscript><link rel="stylesheet" href="../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../twilight_gateway_queue/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../twilight_gateway_queue/index.html"><img class="rust-logo" src="../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Crate twilight_gateway_queue</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.15.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Crate <a class="mod" href="#">twilight_gateway_queue</a><button id="copy-path" title="Copy item path to clipboard"><img src="../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/twilight_gateway_queue/lib.rs.html#1-153">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="twilight-gateway-queue"><a href="#twilight-gateway-queue">twilight-gateway-queue</a></h2>
<p>Ratelimiting functionality for queueing new gateway sessions.</p>
<p>The gateway ratelimits how often clients can initialize new sessions.
Instances of a queue are given to shards so that they can request to
initialize a session.</p>
<p>Queue implementations must point to the same broker so that all shards
across all shard groups, processes, and other forms of multi-serviced
applications, can work together and use the same ratelimiting source. That is,
if two shard groups are in two different processes, then the the two processes
must use some unified form of ratelimiting: this can either mean using IPC to
communicate ratelimiting or a broker.</p>
<h3 id="provided-queues"><a href="#provided-queues">Provided queues</a></h3>
<p>Most users only need the <a href="struct.LocalQueue.html" title="struct twilight_gateway_queue::LocalQueue"><code>LocalQueue</code></a>: it’s a single-process queue for
smaller bots. Larger bots need the <a href="struct.LargeBotQueue.html" title="struct twilight_gateway_queue::LargeBotQueue"><code>LargeBotQueue</code></a>, which supports
single-process <a href="https://discord.com/developers/docs/topics/gateway#sharding-for-large-bots">Sharding for Large Bots</a> through the use of bucket
releasing.</p>
<p>By default, the gateway’s <code>stream</code> module and <code>Shard</code>s use the <a href="struct.LocalQueue.html" title="struct twilight_gateway_queue::LocalQueue"><code>LocalQueue</code></a>.
This can be overridden via the <code>ShardBuilder::queue</code> configuration method.</p>
<h3 id="advanced-use-cases"><a href="#advanced-use-cases">Advanced use cases</a></h3>
<p>Large bots, and smaller bots out of design, may need to implement their own
queue. The most common reason to need this is if you have shard groups in
multiple processes. A broker to manage ratelimiting across shard groups is
required, so a <a href="trait.Queue.html" title="trait twilight_gateway_queue::Queue"><code>Queue</code></a> trait is provided that shards can use to make requests
to create sessions.</p>
<h3 id="features"><a href="#features">Features</a></h3><h4 id="twilight-http"><a href="#twilight-http">Twilight-HTTP</a></h4>
<p>The <code>twilight-http</code> feature brings in support for <a href="struct.LargeBotQueue.html" title="struct twilight_gateway_queue::LargeBotQueue"><code>LargeBotQueue</code></a>.</p>
<p>This is enabled by default.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left"><a class="struct" href="struct.LargeBotQueue.html" title="struct twilight_gateway_queue::LargeBotQueue">LargeBotQueue</a><span class="stab portability" title="Available on crate feature `twilight-http` only"><code>twilight-http</code></span></div><div class="item-right docblock-short">Queue built for single-process groups of shards that require identifying via
<a href="https://discord.com/developers/docs/topics/gateway#sharding-for-very-large-bots">Sharding for Large Bots</a>.</div></div><div class="item-row"><div class="item-left"><a class="struct" href="struct.LocalQueue.html" title="struct twilight_gateway_queue::LocalQueue">LocalQueue</a></div><div class="item-right docblock-short">A local, in-process implementation of a <a href="trait.Queue.html" title="trait twilight_gateway_queue::Queue"><code>Queue</code></a> which manages the
connection attempts of one or more shards.</div></div><div class="item-row"><div class="item-left"><a class="struct" href="struct.NoOpQueue.html" title="struct twilight_gateway_queue::NoOpQueue">NoOpQueue</a></div><div class="item-right docblock-short">An implementation of <a href="trait.Queue.html" title="trait twilight_gateway_queue::Queue"><code>Queue</code></a> that instantly allows requests.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left"><a class="trait" href="trait.Queue.html" title="trait twilight_gateway_queue::Queue">Queue</a></div><div class="item-right docblock-short">Queue for shards to request the ability to initialize new sessions with the
gateway.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-static-root-path="../static.files/" data-current-crate="twilight_gateway_queue" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0-nightly (9a7cc6c32 2023-02-16)" data-search-js="search-14421e1532aead08.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>