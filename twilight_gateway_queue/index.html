<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="twilight-gateway-queue"><meta name="keywords" content="rust, rustlang, rust-lang, twilight_gateway_queue"><title>twilight_gateway_queue - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../normalize.css"><link rel="stylesheet" type="text/css" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../dark.css" disabled><link rel="stylesheet" type="text/css" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script src="../crates.js"></script><script defer src="../main.js"></script>
    <noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../twilight_gateway_queue/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../twilight_gateway_queue/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"><a href="#">Crate twilight_gateway_queue</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.11.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#structs">Structs</a></li><li><a href="#traits">Traits</a></li></ul></div></section><div id="sidebar-vars" data-name="twilight_gateway_queue" data-ty="mod" data-relpath=""></div><script defer src="sidebar-items.js"></script></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../twilight_gateway_queue/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><div id="settings-menu" tabindex="-1">
                                <a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div>
                        </div></form></nav></div><section id="main-content" class="content"><div class="main-heading">
    <h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">twilight_gateway_queue</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/twilight_gateway_queue/lib.rs.html#1-171">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="twilight-gateway-queue"><a href="#twilight-gateway-queue">twilight-gateway-queue</a></h2>
<p>Ratelimiting functionality for queueing new gateway sessions.</p>
<p>The gateway ratelimits how often clients can initialize new sessions.
Instances of a queue are given to shards so that they can request to
initialize a session.</p>
<p>Queue implementations must point to the same broker so that all shards
across all clusters, processes, and other forms of multi-serviced
applications, can work together and use the same ratelimiting source. That
is, if you for example have two clusters in two different processes, then
the two processes must use some unified form of ratelimiting: this can
either mean using IPC to communicate ratelimiting or a broker.</p>
<h3 id="provided-queues"><a href="#provided-queues">Provided queues</a></h3>
<p>Most users only need the <a href="struct.LocalQueue.html" title="LocalQueue"><code>LocalQueue</code></a>: it’s a single-process queue for
smaller bots. Larger bots need the <a href="struct.LargeBotQueue.html" title="LargeBotQueue"><code>LargeBotQueue</code></a>, which supports
single-process <a href="https://discord.com/developers/docs/topics/gateway#sharding-for-large-bots">Sharding for Large Bots</a> through the use of bucket
releasing.</p>
<p>By default, the gateway’s <code>Cluster</code> and <code>Shard</code>s use the <a href="struct.LocalQueue.html" title="LocalQueue"><code>LocalQueue</code></a>. You
can override this in the <code>ClusterBuilder::queue</code> and <code>ShardBuilder::queue</code>
configuration methods.</p>
<h3 id="advanced-use-cases"><a href="#advanced-use-cases">Advanced use cases</a></h3>
<p>Large bots, and smaller bots out of design, may need to implement their own
queue. The most common reason to need this is if you have clusters in
multiple processes. You’ll need a broker to manage ratelimiting across them
all so a <a href="trait.Queue.html" title="Queue"><code>Queue</code></a> trait is provided that shards can use to make requests to
create sessions.</p>
<h3 id="features"><a href="#features">Features</a></h3><h4 id="twilight-http"><a href="#twilight-http">Twilight-HTTP</a></h4>
<p>The <code>twilight-http</code> feature brings in support for <a href="struct.LargeBotQueue.html" title="LargeBotQueue"><code>LargeBotQueue</code></a>.</p>
<p>This is enabled by default.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LargeBotQueue.html" title="twilight_gateway_queue::LargeBotQueue struct">LargeBotQueue</a></div><div class="item-right docblock-short"><p>Queue built for single-process clusters that require identifying via
<a href="https://discord.com/developers/docs/topics/gateway#sharding-for-very-large-bots">Sharding for Very Large Bots</a>.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.LocalQueue.html" title="twilight_gateway_queue::LocalQueue struct">LocalQueue</a></div><div class="item-right docblock-short"><p>A local, in-process implementation of a <a href="trait.Queue.html" title="Queue"><code>Queue</code></a> which manages the
connection attempts of one or more shards.</p>
</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.NoOpQueue.html" title="twilight_gateway_queue::NoOpQueue struct">NoOpQueue</a></div><div class="item-right docblock-short"><p>An implementation of <a href="trait.Queue.html" title="Queue"><code>Queue</code></a> that instantly allows requests.</p>
</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2>
<div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.Queue.html" title="twilight_gateway_queue::Queue trait">Queue</a></div><div class="item-right docblock-short"><p>Queue for shards to request the ability to initialize new sessions with the
gateway.</p>
</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="twilight_gateway_queue" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.63.0-nightly (bb8c2f411 2022-06-19)" ></div>
</body></html>